---
layout: post
title:  "滑落的雨水以及涟漪效果"
date:   2019-05-13
excerpt: "雨水材质."
feature: https://raw.githubusercontent.com/baokeqin/baokeqin.github.io/master/assets/img/blog/post08.gif
tag:
- shader
comments: false
---



<H4>介绍</H4>
<P>这将是两部分中的其中之一，将介绍我如何创建 <B>雨水在斜坡上的表现</B> 在UE4中用材质函数 这一部分将介绍如何在直接受雨撞击的表面上创建雨涟漪/图案，无需多说，让我们开始吧！</P><!--more-->

<H4>Textures</H4>
<P>有两个主要的纹理贴图，我们需要用它来创建所需功能, 第一个是水滴的RGB通道压缩MSK纹理,条纹和条纹渐变. 使用适当的渐变值编写此纹理对于shader准确的工作很重要。.</P>
<figure>
	<a href="https://raw.githubusercontent.com/baokeqin/baokeqin.github.io/master/img/Texture_Packing.jpg"><img src="https://raw.githubusercontent.com/baokeqin/baokeqin.github.io/master/img/Texture_Packing.jpg"></a>
</figure>
<P>在这部分, 我们只会用带液滴遮罩的红色通道, 在第2部分中，将利用其他两个通道来创建条纹效果。</P>
<P>另一个纹理将是水滴的正常贴图</P>
<figure>
	<a href="https://raw.githubusercontent.com/baokeqin/baokeqin.github.io/master/assets/img/blog/post08_img/Droplet_Normal.jpg"><img src="https://raw.githubusercontent.com/baokeqin/baokeqin.github.io/master/assets/img/blog/post08_img/Droplet_Normal.jpg"></a>
</figure>
<H4>基本概念</H4>
<P>基本思想是使用 <A HREF="https://www.youtube.com/watch?v=724ZMiQx200"><B>Alpha 侵蚀</B></A> 在红色通道的图案上我们的通道填充纹理, 用一些额外的数学计算来创造波纹</P>

<P>所以我们开始吧, 在UE4中创建一个新的Material函数，并根据需要命名它。, 我称他为“mf_ripples”（这是一个临时函数，在本文的第2部分中，我们将结合本文中创建的内容）并设置节点，如下所示</P>
<figure>
	<a href="https://raw.githubusercontent.com/baokeqin/baokeqin.github.io/master/assets/img/blog/post08_img/nodes_01.png"><img src="https://raw.githubusercontent.com/baokeqin/baokeqin.github.io/master/assets/img/blog/post08_img/nodes_01.png"></a>
</figure>
<P>上面的网络创建了一个基本的Alpha侵蚀设置, 从我们制作材质函数开始, 我还设置了两个函数输入来控制 <B>涟漪大小</B> 和<B>雨速</B></P>
<xmp>
TextureSample2D.x - (1.0 - frac(time*RainSpeed));
</xmp> 
<P>上面的方程给出了一个简单的周期 0-1, 0-1, 我们可以从 <B>红通道</B> 的贴图, 看到的APLHA侵蚀效应</P>
<figure>
	<a href="https://raw.githubusercontent.com/baokeqin/baokeqin.github.io/master/assets/img/blog/post08_img/nodes_01_vis.gif"><img src="https://raw.githubusercontent.com/baokeqin/baokeqin.github.io/master/assets/img/blog/post08_img/nodes_01_vis.gif"></a>
</figure>
<P>现在我们可以使用一些数学方法来创建一个简单的边缘遮罩，使扩展点看起来像波纹。从“减法”节点中获取结果，然后执行以下操作:</P>
<figure>
	<a href="https://raw.githubusercontent.com/baokeqin/baokeqin.github.io/master/assets/img/blog/post08_img/nodes_02.png"><img src="https://raw.githubusercontent.com/baokeqin/baokeqin.github.io/master/assets/img/blog/post08_img/nodes_02.png"></a>
</figure>
<P>这将导致点的边缘被遮掩，给我们一些看起来像的东西，并扩大波纹</P>
<figure>
	<a href="https://raw.githubusercontent.com/baokeqin/baokeqin.github.io/master/assets/img/blog/post08_img/nodes_02_vis.gif"><img src="https://raw.githubusercontent.com/baokeqin/baokeqin.github.io/master/assets/img/blog/post08_img/nodes_02_vis.gif"></a>
</figure>
<P>不错，但是波纹出现和消失得太突然，我们需要让它们随着时间的推移逐渐消失和消失，以使它看起来更自然。我们可以通过一点数学来达到这个目的:</P>
<figure>
	<a href="https://raw.githubusercontent.com/baokeqin/baokeqin.github.io/master/assets/img/blog/post08_img/nodes_03.png"><img src="https://raw.githubusercontent.com/baokeqin/baokeqin.github.io/master/assets/img/blog/post08_img/nodes_03.png"></a>
</figure>
<P>时间乘以 <B>RainSpeed</B> 我们之前做的变量.</P>
<P>我们要做的是将结果乘以 <B>边缘遮罩</B> 绝对值 sine-波纹 i.e 没有负部分, 有一段时间 [1,0,1] 而不是[1,0,-1,0,1]. 我们重新调整时间sine-波纹 所以它去 [0,1,0] 同时我们的Aphla侵蚀时间函数 [0-1]. 这在下图中可见.</P>
<P>我们乘的方程是</P>
<xmp>
abs(sin((Time*RainSpeed)*0.5));
</xmp>
<img src="{{ site.baseurl }}/{{page.img_path}}/Time_Graph.gif" width="256">
<P>当波纹达到其最大尺寸时，这一结果会很好地从波纹中消失，如下所示</P>
<img src="{{ site.baseurl }}/{{page.img_path}}/nodes_03_vis.gif" width="256">

